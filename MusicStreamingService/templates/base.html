<!DOCTYPE html>
{% load static %}
<html>
	<head>
		<title>FRZN. - Music Streaming Service</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>	<!-- avant les import bootstrap -->
		<script type="text/javascript" src="https://unpkg.com/popper.js@1.15.0/dist/umd/popper.js"></script>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
		<link rel="stylesheet" type="text/css" href="{% static 'css/mainstyle.css' %}">
		{% block headincludes %}
		{% endblock %}
	</head>
	<body>  
		<div id="leftnav" class="row h-100 w-100">	
			<div class="col-md-3 d-none d-md-block bg-dark h-100 p-0">
				<div class="row d-block w-100">
					<div id="logo" class="text-center">
						<a href="/browse/"><img src="{% static 'img/logo.jpg' %}" class="w-25"></a>
					</div>
				</div>
				<div class="row text-center w-100">
					<div id="display_user" class="text-center">
						{{ request.COOKIES.pseudo }}
						<img src="user/media/img/user_avatar/frozone.jpg">
					</div>
				</div>
				<div class="row w-100">
					<nav id="nav_frzn" class="nav flex-column text-center">
						<a href="/user/{{ request.COOKIES.id }}/" class="nav-link text-light w-100 d-block">Mon profil</a></li>
						<a href="/browse/" class="nav-link text-light w-100 d-block">Accueil</a></li>
					</nav>
				</div>
				<div class="row w-100">
					<footer id="footer" class="text-center">
						<div id="logout" class="row w-100">
							<a href="/logout/">Déconnexion</a>
						</div>
						<div class="row w-100">
							<a href="/contact/" class="text-light d-block">Contact</a>
						</div>
						<div class="row w-100">
							<a href="https://github.com/alexanderleecii/" target="_blank" class="text-light d-block">Couchy Alexander-Lee</a>
						</div>
					</footer>
				</div>
			</div>

			<div class="mainsection col-md-9">
			<section class="h-100">
				{% block pagecontent %}{% endblock %}
			</section>
			</div>
		</div>
	</body>
	<script>
		$(window).bind("pageshow", function(event) { //pageshow emitted when accessing session history (back button in this case)
		    if (event.originalEvent.persisted) { //persisted : boolean = if the page was cached when pageshow occurs
		        window.location.reload(); 		 //originalEvent extends the list of properties available for JQuery event object
		    }
		});
	</script>
	<script>
		$(document).on("click", ".add_song", function(){
			var id_song = $(this).attr("name");
			$(document).on("click", "#addsong", function(){
			    $.ajax({
			    	type: "POST",
		            url: "{% url 'add_song_ajax' %}",
		            data: {"id_playlist": $(this).attr("name"),
		            	   "id_song": id_song,
		            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
		        	},
		            success: function(data){
		            	if (data.message == "Ce morceau est déjà dans cette playlist")
		            	{
		            		alert(data.message);
		            	}	
		            }
			    })
			    $('.modal').modal("hide");
			});  
		});
	</script>
	<script>
		$(document).on("click", "#save_playlist", function(){
		    $(this).attr("id", "unsave_playlist");
		    $(this).attr("class", "btn btn-secondary");
		    $(this).html("Retirer de sa bibliothèque");
		    $.ajax({
		    	type: "POST",
	            url: "{% url 'save_playlist_ajax' %}",
	            data: {"id_playlist": $(this).attr("name"),
	            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
	        	},
	            success: function(){
	            }
		    })
		});
	</script>
	<script>
		$(document).on("click", "#unsave_playlist", function(){
		    $(this).attr("id", "save_playlist");
		    $(this).attr("class", "btn btn-primary");
		    $(this).html("Sauvegarder");
		    $.ajax({
		    	type: "POST",
	            url: "{% url 'unsave_playlist_ajax' %}",
	            data: {"id_playlist": $(this).attr("name"),
	            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
	        	},
	            success: function(){
	            }
		    })
		});
	</script>
	<script>
		$(document).on("click", ".save_playlist_search", function(){
		    $(this).attr("class", "unsave_playlist_search btn w-25");
		    $(this).attr("title", "Retirer de sa bibliothèque");
		    $(this).html("<img src='{% static 'img/unsave.png' %}' class='w-50 h-25'>");
		    $.ajax({
		    	type: "POST",
	            url: "{% url 'save_playlist_ajax' %}",
	            data: {"id_playlist": $(this).attr("name"),
	            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
	        	},
	            success: function(){
	            }
		    })
		});
	</script>
	<script>
		$(document).on("click", ".unsave_playlist_search", function(){
		    $(this).attr("class", "save_playlist_search btn w-25");
		    $(this).attr("title", "Sauvegarder");
		    $(this).html("<img src='{% static 'img/save.png' %}' class='w-50 h-25'>");
		    $.ajax({
		    	type: "POST",
	            url: "{% url 'unsave_playlist_ajax' %}",
	            data: {"id_playlist": $(this).attr("name"),
	            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
	        	},
	            success: function(){
	            }
		    })
		});
	</script>
	<script>
		$(document).on("click", "#save_album", function(){
		    $(this).attr("id", "unsave_album");
		    $(this).attr("class", "btn btn-secondary");
		    $(this).html("Retirer de sa bibliothèque");
		    $.ajax({
		    	type: "POST",
	            url: "{% url 'save_album_ajax' %}",
	            data: {"id_album": $(this).attr("name"),
	            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
	        	},
	            success: function(){
	            }
		    })
		});
	</script>
	<script>
		$(document).on("click", "#unsave_album", function(){
		    $(this).attr("id", "save_album");
		    $(this).attr("class", "btn btn-primary");
		    $(this).html("Sauvegarder");
		    $.ajax({
		    	type: "POST",
	            url: "{% url 'unsave_album_ajax' %}",
	            data: {"id_album": $(this).attr("name"),
	            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
	        	},
	            success: function(){
	            }
		    })
		});
	</script>
	<script>
		$(document).on("click", ".save_album_search", function(){
		    $(this).attr("class", "unsave_album_search btn w-25");
		    $(this).attr("title", "Retirer de sa bibliothèque");
		    $(this).html("<img src='{% static 'img/unsave.png' %}' class='w-50 h-25'>");
		    $.ajax({
		    	type: "POST",
	            url: "{% url 'save_album_ajax' %}",
	            data: {"id_album": $(this).attr("name"),
	            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
	        	},
	            success: function(){
	            }
		    })
		});
	</script>
	<script>
		$(document).on("click", ".unsave_album_search", function(){
		    $(this).attr("class", "save_album_search btn w-25");
		    $(this).attr("title", "Sauvegarder");
		    $(this).html("<img src='{% static 'img/save.png' %}' class='w-50 h-25'>");
		    $.ajax({
		    	type: "POST",
	            url: "{% url 'unsave_album_ajax' %}",
	            data: {"id_album": $(this).attr("name"),
	            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
	        	},
	            success: function(){
	            }
		    })
		});
	</script>
	<script>
		$(document).on("click", "#follow", function(){
		    $(this).attr("id", "unfollow");
		    $(this).attr("class", "btn btn-secondary");
		    $(this).html("Ne plus suivre");
		    $.ajax({
		    	type: "POST",
	            url: "{% url 'follow_user_ajax' %}",
	            data: {"id_user": $(this).attr("name"),
	            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
	        	},
	            success: function(){
	            	var nb_followers = $("#nb_followers").html();
				    $("#nb_followers").html(parseInt(nb_followers) + 1);
	            }
		    })    
		});
	</script>
	<script>
		$(document).on("click", "#unfollow", function(){
			    $(this).attr("id", "follow");
			    $(this).attr("class", "btn btn-primary");
			    $(this).html("Suivre");
			    $.ajax({
			    	type: "POST",
		            url: "{% url 'unfollow_user_ajax' %}",
		            data: {"id_user_unfollow": $(this).attr("name"),
		            	   "csrfmiddlewaretoken": "{{ csrf_token }}"
		        	},
		            success: function(){
		            	var nb_followers = $("#nb_followers").html();
					    $("#nb_followers").html(parseInt(nb_followers) - 1);
		            }
			    })
			});
	</script>
</html>